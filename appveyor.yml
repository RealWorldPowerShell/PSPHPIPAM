environment:
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      PSEdition: Core
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      PSEdition: Desktop
  GithubApiKey:
    secure: JUUgqhJzTG2vB53phwWr4gEKcvbA8AJCvSl5UIyFpH3cUprJgoqBmmOo9hJDMIDk
  NugetApiKey:
    secure: QlV2cU1S/Gm6MQviu7jvNwUFmU/G98PgSOda4gjfrY7pPBmZtkps30mHT+0pTPgL
  APPVEYOR_RDP_PASSWORD:
    secure: MEWQ+6pSVNtyr2Rh6f9r7g==
  
skip_branch_with_pr: true


# Skip on updates to the readme.
# We can force this by adding [skip ci] or [ci skip] anywhere in commit message
skip_commits:
  message: /updated (readme|doc).*|update (readme|doc).*s/

build: false

#Kick off the CI/CD pipeline
before_test:
- cmd: |
    docker-compose -f virtual_env/docker-compose.yml up -d
    sleep 120
    docker-compose -f virtual_env/docker-compose.yml exec phpipam sed -i "s/api_allow_unsafe = false/api_allow_unsafe = true/" /var/www/html/config.php
    sleep 120
test_script:
- ps: |
    . .\build.ps1
    
- pwsh: |
    . .\build.ps1

on_failure:
 - ps: $blockRdp = $true;iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))



